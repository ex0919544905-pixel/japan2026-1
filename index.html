<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#F7F6F2" />
  <title>é‡‘æ¾¤ãƒ»é«˜å±±ãƒ»å¯Œå±±ï½œ5å¤©4å¤œæ—…éŠå°å·¥å…·</title>
  <style>
    :root{
      --bg:#F7F6F2;
      --card:#FFFFFF;
      --ink:#1F2937;
      --muted:#6B7280;
      --line:#E7E5E4;
      --accent:#2E7D6B; /* æ—¥å¼æ¸…çˆ½ç¶  */
      --accent2:#C65A3A; /* æš–ç£š */
      --shadow: 0 10px 25px rgba(31,41,55,.08);
      --radius:18px;
      --pad:16px;
      --chip:#F3F4F6;

      --tag-eat-bg:#FFF2E5;
      --tag-eat-ink:#9A4B10;

      --tag-order-bg:#EAF7FF;
      --tag-order-ink:#0B5B7A;

      --tag-buy-bg:#F2EAFF;
      --tag-buy-ink:#5B2AA6;

      --tag-code-bg:#FFE7EF;
      --tag-code-ink:#8A1E49;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "PingFang TC", "Noto Sans TC", "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:var(--bg);
      color:var(--ink);
    }
    a{color:inherit}
    .safe{
      padding: env(safe-area-inset-top) 0 env(safe-area-inset-bottom);
      min-height: 100vh;
      display:flex;
      flex-direction:column;
    }
    header{
      position:sticky; top:0; z-index:20;
      background: color-mix(in srgb, var(--bg) 92%, white 8%);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }
    .topbar{
      padding:14px var(--pad) 10px;
      display:flex; align-items:flex-start; gap:12px;
    }
    .logo{
      width:44px; height:44px;
      border-radius:14px;
      background: linear-gradient(145deg, #ffffff, #f0eee7);
      border:1px solid var(--line);
      display:flex; align-items:center; justify-content:center;
      box-shadow: 0 8px 18px rgba(0,0,0,.06);
      flex:0 0 auto;
    }
    .logo svg{opacity:.95}
    .title h1{
      font-size:16px; margin:0; line-height:1.2;
      letter-spacing:.2px;
    }
    .title p{
      margin:4px 0 0;
      color:var(--muted);
      font-size:12px;
    }
    .tabs{
      display:flex;
      gap:8px;
      padding:0 var(--pad) 12px;
      overflow:auto;
      scrollbar-width:none;
    }
    .tabs::-webkit-scrollbar{display:none}
    .tab{
      border:1px solid var(--line);
      background: #fff;
      padding:9px 12px;
      border-radius:999px;
      font-size:13px;
      white-space:nowrap;
      cursor:pointer;
      transition: transform .08s ease, background .2s ease;
    }
    .tab[aria-selected="true"]{
      border-color: color-mix(in srgb, var(--accent) 35%, var(--line));
      background: color-mix(in srgb, var(--accent) 10%, #fff);
    }
    .content{
      padding: 14px var(--pad) 28px;
      display:flex;
      flex-direction:column;
      gap:14px;
      max-width: 900px;
      width:100%;
      margin:0 auto;
    }

    .section-title{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      margin-top:4px;
    }
    .section-title h2{
      font-size:14px;
      margin:0;
      letter-spacing:.2px;
    }
    .pill{
      font-size:12px;
      color:var(--muted);
      background: color-mix(in srgb, var(--chip) 65%, white 35%);
      border:1px solid var(--line);
      border-radius:999px;
      padding:6px 10px;
      white-space:nowrap;
    }

    .day{
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .day-head{
      padding:14px 14px 12px;
      border-bottom:1px dashed color-mix(in srgb, var(--line) 70%, transparent 30%);
      background:
        radial-gradient(800px 120px at 10% 0%, rgba(46,125,107,.10), transparent 60%),
        radial-gradient(700px 120px at 90% 0%, rgba(198,90,58,.08), transparent 60%);
    }
    .day-head .row{
      display:flex; gap:10px; align-items:flex-start; justify-content:space-between;
    }
    .day-head h3{
      margin:0;
      font-size:15px;
      letter-spacing:.2px;
    }
    .subtitle{
      margin:6px 0 0;
      color:var(--muted);
      font-size:12px;
      line-height:1.4;
    }
    .weather{
      flex:0 0 auto;
      min-width: 126px;
      text-align:right;
    }
    .wx{
      font-weight:700;
      font-size:14px;
    }
    .wx small{
      display:block;
      font-weight:600;
      color:var(--muted);
      font-size:11px;
      margin-top:2px;
    }
    .wx-badge{
      display:inline-flex;
      gap:6px;
      align-items:center;
      justify-content:flex-end;
      padding:7px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.8);
      box-shadow: 0 10px 18px rgba(0,0,0,.05);
      max-width: 200px;
    }
    .wx-badge span{white-space:nowrap}
    .wx-icon{
      width:18px;height:18px;
      display:inline-block;
    }

    .cards{
      padding: 12px 12px 14px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .card{
      border:1px solid var(--line);
      border-radius: 16px;
      padding:12px;
      background:#fff;
    }
    .card-top{
      display:flex;
      gap:10px;
      justify-content:space-between;
      align-items:flex-start;
    }
    .card h4{
      margin:0;
      font-size:14px;
      line-height:1.2;
    }
    .meta{
      margin:6px 0 0;
      color:var(--muted);
      font-size:12px;
      line-height:1.4;
    }
    .right{
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:flex-end;
    }
    .btn{
      display:inline-flex;
      gap:8px;
      align-items:center;
      justify-content:center;
      text-decoration:none;
      padding:8px 10px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: #fff;
      font-size:12px;
      white-space:nowrap;
      cursor:pointer;
    }
    .btn.primary{
      border-color: color-mix(in srgb, var(--accent) 35%, var(--line));
      background: color-mix(in srgb, var(--accent) 10%, #fff);
    }
    .btn svg{width:16px;height:16px;opacity:.9}

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:10px;
    }
    .chip{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      background: var(--chip);
      border:1px solid var(--line);
    }
    .tag{border:0}
    .tag.eat{background:var(--tag-eat-bg); color:var(--tag-eat-ink)}
    .tag.order{background:var(--tag-order-bg); color:var(--tag-order-ink)}
    .tag.buy{background:var(--tag-buy-bg); color:var(--tag-buy-ink)}
    .tag.code{background:var(--tag-code-bg); color:var(--tag-code-ink); font-weight:800}
    .divider{
      height:1px;
      background: var(--line);
      margin:12px 0;
    }
    .note{
      background: color-mix(in srgb, var(--accent) 7%, #fff);
      border:1px solid color-mix(in srgb, var(--accent) 18%, var(--line));
      padding:12px;
      border-radius:16px;
      color: color-mix(in srgb, var(--ink) 90%, var(--accent) 10%);
      font-size:12.5px;
      line-height:1.55;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media (min-width: 860px){
      .grid{grid-template-columns: 1fr 1fr}
    }

    /* è¡¨æ ¼ï¼ˆé ç®—ï¼‰ */
    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border-radius:16px;
      border:1px solid var(--line);
      background:#fff;
    }
    th, td{
      padding:10px 10px;
      font-size:13px;
      border-bottom:1px solid var(--line);
      vertical-align:top;
    }
    th{
      text-align:left;
      background: color-mix(in srgb, var(--bg) 70%, #fff 30%);
      font-size:12px;
      color:var(--muted);
      letter-spacing:.2px;
    }
    tr:last-child td{border-bottom:0}
    input[type="text"], input[type="number"], select{
      width:100%;
      padding:9px 10px;
      border-radius:12px;
      border:1px solid var(--line);
      font-size:14px;
      background:#fff;
    }
    .row2{
      display:grid;
      grid-template-columns: 1.2fr .8fr .8fr;
      gap:10px;
    }
    .total{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      padding:12px;
      border-radius:16px;
      border:1px solid var(--line);
      background:#fff;
      box-shadow: var(--shadow);
      font-size:14px;
    }
    .kpi{
      font-weight:800;
      letter-spacing:.2px;
    }
    .muted{color:var(--muted)}
    .small{font-size:12px}

    /* å°å°ã€ŒåŸç”Ÿæ„Ÿã€åº•éƒ¨ç©ºé–“ */
    .footer-space{height:18px}

    /* toast */
    .toast{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom: 18px;
      background: rgba(31,41,55,.92);
      color:#fff;
      padding:10px 12px;
      border-radius:999px;
      font-size:12px;
      opacity:0;
      pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
      max-width: calc(100vw - 28px);
      text-align:center;
    }
    .toast.show{
      opacity:1;
      transform:translateX(-50%) translateY(-6px);
    }
  </style>
</head>
<body>
<div class="safe">
  <header>
    <div class="topbar">
      <div class="logo" aria-hidden="true">
        <svg viewBox="0 0 24 24" width="22" height="22" fill="none">
          <path d="M5 8.5c4.5-3.5 9.5-3.5 14 0" stroke="#2E7D6B" stroke-width="2.2" stroke-linecap="round"/>
          <path d="M7 14c3.2-2.4 6.8-2.4 10 0" stroke="#C65A3A" stroke-width="2.2" stroke-linecap="round"/>
          <circle cx="12" cy="18.5" r="1.4" fill="#1F2937"/>
        </svg>
      </div>
      <div class="title">
        <h1>é‡‘æ¾¤ãƒ»é«˜å±±ãƒ»å¯Œå±±ï½œ5å¤©4å¤œæ—…éŠå°å·¥å…·</h1>
        <p>æ‰‹æ©Ÿå„ªå…ˆï½œè¡Œç¨‹å¡ç‰‡ãƒ»å°èˆªãƒ»å¤©æ°£ãƒ»å°éŠç­†è¨˜ãƒ»è¨˜å¸³ï¼ˆæ²ˆ/ç‘„/YOï¼‰</p>
      </div>
    </div>
    <div class="tabs" role="tablist" aria-label="pages">
      <button class="tab" role="tab" id="tab-itin" aria-selected="true" aria-controls="page-itin">è¡Œç¨‹</button>
      <button class="tab" role="tab" id="tab-info" aria-selected="false" aria-controls="page-info">è³‡è¨Š</button>
      <button class="tab" role="tab" id="tab-budget" aria-selected="false" aria-controls="page-budget">è¨˜å¸³/é ç®—</button>
      <button class="tab" role="tab" id="tab-notes" aria-selected="false" aria-controls="page-notes">å°ç­†è¨˜</button>
    </div>
  </header>

  <main class="content">
    <!-- è¡Œç¨‹é  -->
    <section id="page-itin" role="tabpanel" aria-labelledby="tab-itin">
      <div class="section-title">
        <h2>æ¯æ—¥è¡Œç¨‹</h2>
        <span class="pill" id="todayHint">å¯åœ¨å¡ç‰‡å³ä¸Šè§’ä¸€éµå°èˆª</span>
      </div>
      <div id="days"></div>
      <div class="footer-space"></div>
    </section>

    <!-- è³‡è¨Šé  -->
    <section id="page-info" role="tabpanel" aria-labelledby="tab-info" hidden>
      <div class="section-title">
        <h2>èˆªç­ / ä½å®¿ / ç·Šæ€¥è¯çµ¡</h2>
        <span class="pill">ä¸€é é›†ä¸­ï¼Œå‡ºåœ‹ä¸ç”¨ç¿»</span>
      </div>

      <div class="grid">
        <div class="day">
          <div class="day-head">
            <div class="row">
              <div>
                <h3>âœˆï¸ èˆªç­è³‡è¨Š</h3>
                <p class="subtitle">é•·æ¦®ï¼šå»ç¨‹ BR158ã€å›ç¨‹ BR157</p>
              </div>
              <div class="weather">
                <div class="wx-badge">
                  <span class="wx">æé†’</span>
                  <small class="muted">ææ—©åˆ°æ©Ÿå ´ã€åˆ¥å£“ç·š</small>
                </div>
              </div>
            </div>
          </div>
          <div class="cards">
            <div class="card">
              <div class="card-top">
                <div>
                  <h4>å»ç¨‹ï¼šæ¡ƒåœ’ â†’ å°æ¾ï¼ˆKMQï¼‰</h4>
                  <p class="meta">BR158ï½œ06:35 - 10:25ï¼ˆæ¡ƒåœ’äºŒèˆªï¼‰</p>
                </div>
                <div class="right">
                  <a class="btn primary" target="_blank" rel="noopener"
                     href="https://www.google.com/maps/search/?api=1&query=æ¡ƒåœ’åœ‹éš›æ©Ÿå ´ç¬¬äºŒèˆªå»ˆ">
                    <svg viewBox="0 0 24 24" fill="none"><path d="M12 21s7-6 7-12a7 7 0 1 0-14 0c0 6 7 12 7 12Z" stroke="currentColor" stroke-width="1.8"/><path d="M12 12.2a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" stroke="currentColor" stroke-width="1.8"/></svg>
                    å°èˆªæ©Ÿå ´
                  </a>
                </div>
              </div>
              <div class="chips">
                <span class="chip tag code">é‡è¦ï¼šè­·ç…§ / å…¥å¢ƒè³‡æ–™ / è¡Œæé‡é‡</span>
              </div>
            </div>
            <div class="card">
              <div class="card-top">
                <div>
                  <h4>å›ç¨‹ï¼šå°æ¾ï¼ˆKMQï¼‰â†’ æ¡ƒåœ’</h4>
                  <p class="meta">BR157ï½œ11:45 - 14:35</p>
                </div>
                <div class="right">
                  <a class="btn primary" target="_blank" rel="noopener"
                     href="https://www.google.com/maps/search/?api=1&query=å°æ¾ç©ºæ¸¯">
                    <svg viewBox="0 0 24 24" fill="none"><path d="M12 21s7-6 7-12a7 7 0 1 0-14 0c0 6 7 12 7 12Z" stroke="currentColor" stroke-width="1.8"/><path d="M12 12.2a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" stroke="currentColor" stroke-width="1.8"/></svg>
                    å°èˆªå°æ¾æ©Ÿå ´
                  </a>
                </div>
              </div>
              <div class="chips">
                <span class="chip">æ©Ÿå ´å·´å£«ï¼šé‡‘æ¾¤ç«™è¥¿å£ â†’ å°æ¾ç©ºæ¸¯ï¼ˆç´„40åˆ†ï¼‰</span>
              </div>
            </div>
          </div>
        </div>

        <div class="day">
          <div class="day-head">
            <div class="row">
              <div>
                <h3>ğŸ¨ ä½å®¿è³‡è¨Š</h3>
                <p class="subtitle">SOKI KANAZAWAï½œè¡Œæå¯„å­˜å¯ç”¨</p>
              </div>
              <div class="weather">
                <div class="wx-badge">
                  <span class="wx">Check-in</span>
                  <small>15:00 / é€€æˆ¿ 11:00</small>
                </div>
              </div>
            </div>
          </div>
          <div class="cards">
            <div class="card">
              <div class="card-top">
                <div>
                  <h4>SOKI KANAZAWA</h4>
                  <p class="meta">2ç•ª1å· Fukuromachi, Kanazawa, Ishikawa 920-0909</p>
                  <p class="meta small muted">ï¼ˆåœ°å€èˆ‡å…¥ä½é€€æˆ¿æ™‚é–“ä¾ä½ çš„ PDFï¼‰</p>
                </div>
                <div class="right">
                  <a class="btn primary" target="_blank" rel="noopener"
                     href="https://www.google.com/maps/search/?api=1&query=SOKI%20KANAZAWA">
                    <svg viewBox="0 0 24 24" fill="none"><path d="M12 21s7-6 7-12a7 7 0 1 0-14 0c0 6 7 12 7 12Z" stroke="currentColor" stroke-width="1.8"/><path d="M12 12.2a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" stroke="currentColor" stroke-width="1.8"/></svg>
                    å°èˆªé£¯åº—
                  </a>
                </div>
              </div>
              <div class="chips">
                <span class="chip">è¡Œæå¯„å­˜ï¼šå¯å…ˆå¯„å†é€›ï¼ˆåˆ°ç«™å¾Œå¾ˆæ–¹ä¾¿ï¼‰</span>
              </div>
            </div>
          </div>
        </div>

        <div class="day">
          <div class="day-head">
            <div class="row">
              <div>
                <h3>â˜ï¸ ç·Šæ€¥è¯çµ¡</h3>
                <p class="subtitle">å…ˆå­˜èµ·ä¾†ï¼šéœ€è¦æ™‚ä¸ç”¨æ‰¾ç¶²è·¯</p>
              </div>
              <div class="weather">
                <div class="wx-badge">
                  <span class="wx">æ—¥æœ¬</span>
                  <small>ç·Šæ€¥é›»è©±</small>
                </div>
              </div>
            </div>
          </div>
          <div class="cards">
            <div class="card">
              <h4>ç·Šæ€¥é›»è©±ï¼ˆæ—¥æœ¬ï¼‰</h4>
              <p class="meta">ğŸš“ è­¦å¯Ÿï¼š110ã€€ã€€ğŸš’/ğŸš‘ æ¶ˆé˜²/æ•‘è­·ï¼š119</p>
              <div class="divider"></div>
              <h4>åœ¨åœ°æ±‚åŠ©</h4>
              <p class="meta">ğŸ“ Japan Visitor Hotlineï¼š050-3816-2787ï¼ˆå…¨å¹´ç„¡ä¼‘ï¼Œå¤šèªï¼‰</p>
              <p class="meta small muted">ï¼Šè‹¥ä½ å€‘æœ‰ä¿éšªå…¬å¸/ä¿¡ç”¨å¡ç·Šæ€¥å°ˆç·šï¼Œå¯åœ¨ã€Œå°ç­†è¨˜ã€é è‡ªè¡ŒåŠ ä¸Šã€‚</p>
            </div>
          </div>
        </div>

        <div class="day">
          <div class="day-head">
            <div class="row">
              <div>
                <h3>ğŸšŒ é‡è¦é ç´„ / äº¤é€šé€£çµ</h3>
                <p class="subtitle">æŠŠä½  PDF è£¡çš„é—œéµé€£çµé›†ä¸­</p>
              </div>
              <div class="weather">
                <div class="wx-badge">
                  <span class="wx">å¿…çœ‹</span>
                  <small>å‡ºç™¼å‰ç¢ºèª</small>
                </div>
              </div>
            </div>
          </div>
          <div class="cards">
            <div class="card">
              <h4>é‡‘æ¾¤ â†’ é«˜å±± å·´å£«ï¼ˆ08:10 ç›´é”ï¼‰</h4>
              <p class="meta">é ç´„ï¼šJapan Bus Onlineï¼ˆä½  PDF è¨»è¨˜çš„é€£çµï¼‰</p>
              <div class="chips">
                <span class="chip tag code">é‡è¦é ç´„ä»£è™Ÿï¼šè«‹åœ¨å°ç­†è¨˜é è²¼ä¸Šï¼ˆä½ å€‘è¨‚å®Œå¾Œï¼‰</span>
                <a class="btn" target="_blank" rel="noopener" href="https://japanbusonline.com/zh-tw">é–‹å•Ÿé ç´„ç¶²ç«™</a>
              </div>
              <div class="divider"></div>
              <h4>é‡‘æ¾¤ â†’ å°æ¾æ©Ÿå ´ å·´å£«æ™‚åˆ»</h4>
              <div class="chips">
                <a class="btn" target="_blank" rel="noopener" href="https://www.hokutetsu.co.jp/tc/airport/kanazawa/#section1">é–‹å•Ÿæ™‚åˆ»è¡¨</a>
              </div>
            </div>
          </div>
        </div>

      </div>
      <div class="footer-space"></div>
    </section>

    <!-- è¨˜å¸³/é ç®—é  -->
    <section id="page-budget" role="tabpanel" aria-labelledby="tab-budget" hidden>
      <div class="section-title">
        <h2>è¨˜å¸³ / é ç®—è¡¨ï¼ˆæ²ˆ / ç‘„ / YOï¼‰</h2>
        <span class="pill">å¯é›¢ç·šç”¨ï¼ˆæœƒå­˜åœ¨æœ¬æ©Ÿï¼‰</span>
      </div>

      <div class="note">
        âœ… ä½ å€‘ä¸‰äººæ—…è¡Œï¼šè¼¸å…¥é‡‘é¡å¾Œå¯é¸ã€Œèª°ä»˜ã€ï¼Œä¹Ÿå¯é¸ã€Œå¹³åˆ†ã€æˆ–è‡ªè¨‚åˆ†æ”¤ã€‚<br/>
        âœ… æ‰€æœ‰è³‡æ–™åªå­˜åœ¨ä½ æ‰‹æ©Ÿï¼ˆlocalStorageï¼‰ï¼Œä¸æœƒä¸Šå‚³ã€‚
      </div>

      <div class="day">
        <div class="day-head">
          <div class="row">
            <div>
              <h3>æ–°å¢ä¸€ç­†èŠ±è²»</h3>
              <p class="subtitle">ä¾‹å¦‚ï¼šè»Šç¥¨ã€é¤è²»ã€ä¼´æ‰‹ç¦®ã€ä½å®¿åŠ è³¼â€¦</p>
            </div>
            <div class="weather">
              <div class="wx-badge">
                <span class="wx">å°æŠ€å·§</span>
                <small>å¤šç”¨åˆ†é¡æ–¹ä¾¿å›é¡§</small>
              </div>
            </div>
          </div>
        </div>
        <div class="cards">
          <div class="row2">
            <div>
              <label class="small muted">é …ç›®</label>
              <input id="expTitle" type="text" placeholder="ä¾‹å¦‚ï¼šå…¼å…­åœ’é–€ç¥¨ / SWAY COFFEE" />
            </div>
            <div>
              <label class="small muted">é‡‘é¡ï¼ˆJPYï¼‰</label>
              <input id="expAmount" type="number" inputmode="numeric" placeholder="0" />
            </div>
            <div>
              <label class="small muted">åˆ†é¡</label>
              <select id="expCat">
                <option value="äº¤é€š">äº¤é€š</option>
                <option value="é¤é£²">é¤é£²</option>
                <option value="æ™¯é»">æ™¯é»</option>
                <option value="ä½å®¿">ä½å®¿</option>
                <option value="è³¼ç‰©">è³¼ç‰©</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
              </select>
            </div>
          </div>

          <div class="row2" style="margin-top:10px">
            <div>
              <label class="small muted">èª°å…ˆä»˜æ¬¾</label>
              <select id="expPayer">
                <option value="æ²ˆ">æ²ˆ</option>
                <option value="ç‘„">ç‘„</option>
                <option value="YO">YO</option>
              </select>
            </div>
            <div>
              <label class="small muted">åˆ†æ”¤æ–¹å¼</label>
              <select id="expSplitMode">
                <option value="equal">ä¸‰äººå¹³åˆ†</option>
                <option value="custom">è‡ªè¨‚åˆ†æ”¤</option>
              </select>
            </div>
            <div style="display:flex; align-items:flex-end; gap:10px;">
              <button class="btn primary" id="addExpense" style="width:100%; justify-content:center;">
                ï¼‹ åŠ å…¥
              </button>
            </div>
          </div>

          <div id="customSplit" hidden style="margin-top:10px">
            <div class="row2">
              <div>
                <label class="small muted">æ²ˆ åˆ†æ”¤ï¼ˆJPYï¼‰</label>
                <input id="splitShen" type="number" inputmode="numeric" placeholder="0" />
              </div>
              <div>
                <label class="small muted">ç‘„ åˆ†æ”¤ï¼ˆJPYï¼‰</label>
                <input id="splitXuan" type="number" inputmode="numeric" placeholder="0" />
              </div>
              <div>
                <label class="small muted">YO åˆ†æ”¤ï¼ˆJPYï¼‰</label>
                <input id="splitYO" type="number" inputmode="numeric" placeholder="0" />
              </div>
            </div>
            <p class="small muted" style="margin:8px 2px 0">
              è‡ªè¨‚åˆ†æ”¤åˆè¨ˆéœ€ç­‰æ–¼é‡‘é¡ï¼›ä¸ç­‰æ–¼æ™‚æœƒæç¤ºã€‚
            </p>
          </div>

        </div>
      </div>

      <div class="total" style="margin-top:12px">
        <div>
          <div class="muted small">ç›®å‰ç¸½æ”¯å‡ºï¼ˆJPYï¼‰</div>
          <div class="kpi" id="sumAll">0</div>
        </div>
        <div style="text-align:right">
          <div class="muted small">æ¸…ç®—ï¼šèª°æ‡‰æ”¶/æ‡‰ä»˜</div>
          <div class="kpi" id="settleHint">â€”</div>
        </div>
      </div>

      <div class="day" style="margin-top:12px">
        <div class="day-head">
          <div class="row">
            <div>
              <h3>æ˜ç´°</h3>
              <p class="subtitle">å¯åˆªé™¤ï¼›é•·æŒ‰å¯è¤‡è£½</p>
            </div>
            <div class="weather">
              <button class="btn" id="clearAll">æ¸…ç©º</button>
            </div>
          </div>
        </div>
        <div class="cards" id="expenseList"></div>
      </div>

      <div class="footer-space"></div>
    </section>

    <!-- å°ç­†è¨˜é  -->
    <section id="page-notes" role="tabpanel" aria-labelledby="tab-notes" hidden>
      <div class="section-title">
        <h2>å°ç­†è¨˜ï¼ˆé›†åˆä½ å€‘ä¸‰äººçš„è³‡è¨Šï¼‰</h2>
        <span class="pill">é ç´„ä»£è™Ÿ/è¡Œæ/å¿…è²·æ¸…å–®</span>
      </div>

      <div class="day">
        <div class="day-head">
          <div class="row">
            <div>
              <h3>ğŸ“Œ é‡è¦é ç´„ä»£è™Ÿï¼ˆè²¼ä¸Šå°±å¥½ï¼‰</h3>
              <p class="subtitle">ä¾‹å¦‚ï¼šå·´å£«è¨‚ä½ã€é¤å»³é ç´„ã€é–€ç¥¨QRç­‰</p>
            </div>
          </div>
        </div>
        <div class="cards">
          <textarea id="codes" rows="6" style="width:100%; padding:12px; border-radius:16px; border:1px solid var(--line); font-size:14px;"></textarea>
          <button class="btn primary" id="saveCodes">å„²å­˜</button>
          <div class="note">
            å»ºè­°æ ¼å¼ï¼š<br/>
            ãƒ»é‡‘æ¾¤â†’é«˜å±±å·´å£«ï¼šè¨‚ä½ä»£è™Ÿ XXXXX / åº§ä½ XX<br/>
            ãƒ»æŸé¤å»³ï¼šäºˆç´„ç•ªå· XXXX / åˆ°åº—æ™‚é–“ XX:XX
          </div>
        </div>
      </div>

      <div class="day">
        <div class="day-head">
          <div class="row">
            <div>
              <h3>ğŸ§³ è¡Œæ/æé†’</h3>
              <p class="subtitle">ä½ å€‘æ¯æ¬¡éƒ½æœƒæœ‰äººå¿˜è¨˜çš„é‚£ç¨®</p>
            </div>
          </div>
        </div>
        <div class="cards">
          <textarea id="reminders" rows="7" style="width:100%; padding:12px; border-radius:16px; border:1px solid var(--line); font-size:14px;"></textarea>
          <button class="btn primary" id="saveRem">å„²å­˜</button>
        </div>
      </div>

      <div class="footer-space"></div>
    </section>
  </main>
</div>

<div class="toast" id="toast">å·²å„²å­˜</div>

<script>
  // ===== åŸºç¤è³‡æ–™ï¼ˆä¾ä½ çš„ PDF è¡Œç¨‹æ•´ç†ï¼‰=====
  // åŸå¸‚åº§æ¨™ï¼šç”¨æ–¼ Open-Meteo å¤©æ°£
  const cityGeo = {
    "é‡‘æ¾¤": { lat: 36.5613, lon: 136.6562 },
    "é«˜å±±": { lat: 36.1462, lon: 137.2522 },
    "å¯Œå±±": { lat: 36.6953, lon: 137.2113 },
    "å°æ¾": { lat: 36.3946, lon: 136.4066 },
  };

  // è¡Œç¨‹ï¼ˆ1/1-1/5ï¼‰
  const itinerary = [
    {
      date: "2026-01-01ï¼ˆå››ï¼‰",
      city: "å°æ¾ â†’ é‡‘æ¾¤ â†’ å¯Œå±± â†’ é«˜å±±",
      weatherCity: "é«˜å±±",
      focus: "æŠµé”æ—¥æœ¬ï½œè½‰è»Šé€²é«˜å±±ï½œé€›è€è¡—/é…’é€ /é™å®šæ¯",
      cards: [
        {
          type: "äº¤é€š",
          title: "BR158 æ¡ƒåœ’ â†’ å°æ¾",
          time: "06:35 - 10:25",
          place: "å°æ¾æ©Ÿå ´ (Komatsu Airport)",
          detail: "åˆ°æ©Ÿå ´å ±åˆ°ï¼ˆå»ºè­°ææ—©åˆ°ï¼‰ã€‚",
          navQuery: "å°æ¾ç©ºæ¸¯"
        },
        {
          type: "äº¤é€š",
          title: "é‡‘æ¾¤ â†’ å¯Œå±± â†’ é«˜å±±ï¼ˆæŒ‡å®šå¸­ï¼‰",
          time: "æ–°å¹¹ç·š åŠ Tsurugi 60ï¼š06:51â†’07:14ï½œç‰¹æ€¥ é£›é©’ Hida 6ï¼š07:58â†’09:28",
          place: "é‡‘æ¾¤ç«™ / å¯Œå±±ç«™ / é«˜å±±ç«™",
          detail: "ç¥¨åƒ¹å‚™è¨»ï¼šæ–°å¹¹ç·š 2,860å††ã€ç‰¹æ€¥ 3,620å††ï¼ˆå–®ç¨‹ï¼‰ã€‚",
          navQuery: "é‡‘æ¾¤é§…"
        },
        {
          type: "é¤å»³",
          title: "ï¼ˆæƒ³é€›/æƒ³åƒï¼‰é«˜å±±è€è¡—è·¯ç·š",
          time: "ç™½å¤©",
          place: "æ˜Ÿå·´å…‹ é«˜å±±å²¡æœ¬åº— / èˆ©å‚é…’é€ åº— / ã¿ã£ãµãƒãƒ¼ãŠã‚„ã¤å ‚ / é«˜å±±å¸ƒä¸äº­",
          detail: "å»ºè­°ç”¨ã€èµ°é€›ï¼‹é‚Šåƒã€æ¨¡å¼ï¼šæŠŠæƒ³è²·çš„é›†ä¸­ä¸€æ¢ç·šã€‚",
          navQuery: "é«˜å±± å²¡æœ¬ç”º"
        },
        {
          type: "å°éŠ",
          title: "é«˜å±±å¿…åƒï¼†æ”»ç•¥ï¼ˆå¿«é€Ÿç‰ˆï¼‰",
          time: "å»ºè­°ï¼šåˆåï½å‚æ™š",
          place: "ä¸‰ç”ºç­‹ï¼ˆSanmachi Sujiï¼‰ä¸€å¸¶",
          detail:
            "é«˜å±±è€è¡—ï¼ˆå•†å®¶ç”ºï¼‰ä»¥æ±Ÿæˆ¶é¢¨æœ¨é€ è¡—æ™¯èˆ‡ã€é‚Šèµ°é‚Šåƒã€å¾ˆæœ‰åï¼š\n" +
            "ãƒ»å¿…åƒï¼šé£›é©’ç‰›ï¼ˆæ¡å£½å¸/ä¸²ç‡’/å¯æ¨‚é¤…ï¼‰\n" +
            "ãƒ»å¿…åƒï¼šäº”å¹³é¤…ã€ã¿ãŸã‚‰ã—å›£å­\n" +
            "ãƒ»å¿…å–ï¼šåœ¨åœ°æ¸…é…’ï¼ˆé…’é€ å¤šï¼Œå¯è©¦é£²ï¼‰",
          tags: [
            { kind:"eat", text:"å¿…åƒï¼šé£›é©’ç‰›ï¼ˆæ¡å£½å¸/ä¸²ç‡’ï¼‰" },
            { kind:"eat", text:"å¿…åƒï¼šäº”å¹³é¤… / ã¿ãŸã‚‰ã—å›£å­" },
            { kind:"order", text:"å¿…é»ï¼šæƒ³åƒå°±å…ˆè²·ï¼ˆç†±é–€æ”¤ä½æ˜“æ’ï¼‰" },
            { kind:"buy", text:"å¿…è²·ï¼šé™å®šæ¯/ä¼´æ‰‹ç¦®ï¼ˆä¾ä½ æ¸…å–®ï¼‰" },
          ],
          navQuery: "é«˜å±± ä¸‰ç”ºç­‹"
        }
      ]
    },

    {
      date: "2026-01-02ï¼ˆäº”ï¼‰",
      city: "é‡‘æ¾¤",
      weatherCity: "é‡‘æ¾¤",
      focus: "é‡‘æ¾¤21ä¸–ç´€ç¾è¡“é¤¨ï½œLe MusÃ©e de Hï½œæ±èŒ¶å±‹è¡—",
      cards: [
        {
          type: "é¤å»³",
          title: "æ—©é¤ï¼šæ±å‡ºçˆç²åº—",
          time: "09:00-10:00ï¼ˆä½ å®‰æ’çš„æ™‚é–“ï¼‰",
          place: "æ±å‡ºçˆç²åº—ï¼ˆKanazawaï¼‰",
          detail: "è¡Œå‰å»ºè­°ï¼šå¦‚æœå®¢æ»¿å°±å‚™æ¡ˆæ‰¾é™„è¿‘å’–å•¡åº—ã€‚",
          navQuery: "æ±å‡ºçˆç²åº— é‡‘æ²¢"
        },
        {
          type: "æ™¯é»",
          title: "é‡‘æ¾¤21ä¸–ç´€ç¾è¡“é¤¨ï¼ˆæ³³æ± å¿…çœ‹ï¼‰",
          time: "09:00-18:00",
          place: "21st Century Museum of Contemporary Art, Kanazawa",
          detail:
            "å¿…çœ‹ä½œå“ï¼šLeandro Erlichã€ŠThe Swimming Poolã€‹â€”â€”å¾ä¸Šæ–¹çœ‹åƒçœŸçš„æ³³æ± ï¼Œå¯¦éš›åªæœ‰è–„è–„æ°´å±¤ï¼Œä¸‹æ–¹å¯èµ°é€²ã€æ± åº•ã€æ‹ç…§ã€‚",
          tags: [
            { kind:"order", text:"å¿…æ‹ï¼šæ³³æ± ä¸Š/ä¸‹è¦–è§’" },
            { kind:"eat", text:"ç¾è¡“é¤¨å‘¨é‚Šå’–å•¡å¯ç•¶è£œè¡€é»" }
          ],
          navQuery: "é‡‘æ²¢21ä¸–ç´€ç¾è¡“é¤¨"
        },
        {
          type: "é¤å»³",
          title: "Le MusÃ©e de H é‡‘æ¾¤åº—ï¼ˆè²·ä¼´æ‰‹ç¦®å°±å¥½ï¼‰",
          time: "10:00-16:00ï¼ˆ15:00æœ€å¾Œé»é¤ï¼‰",
          place: "Le MusÃ©e de H Kanazawa",
          detail: "ä½ å€‘çš„ç­–ç•¥å¾ˆæ­£ç¢ºï¼šç•¶ã€ç”œé»ä¼´æ‰‹ç¦®è£œçµ¦ç«™ã€ã€‚",
          tags: [
            { kind:"buy", text:"å¿…è²·ï¼šç”œé»ä¼´æ‰‹ç¦®ï¼ˆå¯æ‰“åŒ…ï¼‰" }
          ],
          navQuery: "Le MusÃ©e de H é‡‘æ²¢"
        },
        {
          type: "æ™¯é»",
          title: "æ±èŒ¶å±‹è¡—ï¼ˆæ•£æ­¥ï¼‹ç”œé»ï¼‰",
          time: "åˆå¾Œ",
          place: "Higashi Chaya District",
          detail:
            "é‡‘æ¾¤ä»£è¡¨æ€§çš„èŒ¶å±‹è¡—ã€‚å¾ˆå¤šåº—æœƒè³£é‡‘ç®”ç”œé»ï¼ˆåƒé‡‘ç®”éœœæ·‡æ·‹ï¼‰å¾ˆæœ‰ã€é‡‘æ¾¤æ„Ÿã€ã€‚",
          tags: [
            { kind:"eat", text:"å¿…åƒï¼šé‡‘ç®”éœœæ·‡æ·‹" },
            { kind:"buy", text:"å¿…è²·ï¼šé‡‘ç®”å°ç‰©/é»å¿ƒ" }
          ],
          navQuery: "æ±èŒ¶å±‹è¡—"
        }
      ]
    },

    {
      date: "2026-01-03ï¼ˆå…­ï¼‰",
      city: "é‡‘æ¾¤ï¼ˆç«™å‘¨é‚Šè³¼ç‰©æ—¥ï¼‰",
      weatherCity: "é‡‘æ¾¤",
      focus: "é‡‘æ¾¤ç«™ï¼†FORUS è²·è²·è²·ï½œå–ç¥¨/å¯„è¡Œæ",
      cards: [
        {
          type: "äº¤é€š",
          title: "å°æ¾æ©Ÿå ´ â†’ é‡‘æ¾¤ç«™ï¼ˆåˆ©æœ¨æ´¥å·´å£«ï¼‰",
          time: "ç´„40åˆ†ï½œ1,300å††",
          place: "é‡‘æ¾¤ç«™è¥¿å£",
          detail: "åˆ°ç«™å¾Œï¼šå…ˆæ‰¾è²©è³£æ©Ÿå–ç¥¨ â†’ æ­¥è¡Œç´„5åˆ†é˜åˆ° FORUS å¯„è¡Œæå†é€›ã€‚",
          navQuery: "é‡‘æ²¢é§… è¥¿å£"
        },
        {
          type: "æ™¯é»",
          title: "é‡‘æ¾¤FORUSï¼ˆç™¾è²¨é›†ä¸­é€›ï¼‰",
          time: "ä¸­åˆï½å‚æ™š",
          place: "é‡‘æ¾¤FORUS",
          detail:
            "ä½  PDF è£¡åˆ—çš„æ¨“å±¤æ¸…å–®ï¼šnico and... / Free-Spirits / UQã€ç„¡å°ã€å¯¶å¯å¤¢ä¸­å¿ƒ / ABCã€LOFT / æ˜Ÿå·´å…‹ ç­‰ã€‚",
          tags: [
            { kind:"buy", text:"å¿…è²·ï¼šæƒ³è²·å°±å…ˆä¸‹æ‰‹ï¼ˆé¿å…éš”å¤©è·‘å›ä¾†ï¼‰" }
          ],
          navQuery: "é‡‘æ²¢ãƒ•ã‚©ãƒ¼ãƒ©ã‚¹"
        },
        {
          type: "å°éŠ",
          title: "é‡‘æ¾¤ä¼´æ‰‹ç¦®æ–¹å‘ï¼ˆå¿«é€Ÿç‰ˆï¼‰",
          time: "è³¼ç‰©æ—¥ä¸€èµ·è™•ç†",
          place: "ç«™å‘¨é‚Š / ç™¾è²¨ / ç”œé»åº—",
          detail:
            "é‡‘æ¾¤çš„ã€é‡‘ç®”ã€å¾ˆæœ‰åï¼Œä¹Ÿå¸¸è¦‹å¯å¸¶èµ°çš„å°é»å¿ƒèˆ‡å·¥è—å°ç‰©ã€‚\n" +
            "ãƒ»ä¼´æ‰‹ç¦®æ–¹å‘ï¼šé‡‘ç®”ç³»ç”œé»ã€åŠ è³€æ£’èŒ¶ã€å’Œè“å­\n" +
            "ãƒ»å·¥è—æ–¹å‘ï¼šé‡‘ç®”å°ç‰©ã€æ¼†å™¨/æœ¨è£½é›œè²¨ï¼ˆä½ å€‘å·²é–å®šé™å®šæ¯ï¼‰",
          tags: [
            { kind:"buy", text:"å¿…è²·ï¼šé‡‘ç®”ç³»/åŠ è³€æ£’èŒ¶ç³»" },
            { kind:"order", text:"å¿…åšï¼šå…ˆæŠŠã€è¦è²·æ¸…å–®ã€åœ¨æ­¤æ—¥æ¸…æ‰" }
          ],
          navQuery: "é‡‘æ²¢é§… ãŠåœŸç”£"
        }
      ]
    },

    {
      date: "2026-01-04ï¼ˆæ—¥ï¼‰",
      city: "é‡‘æ¾¤",
      weatherCity: "é‡‘æ¾¤",
      focus: "å…¼å…­åœ’ï¼†é‡‘æ¾¤åŸï½œè¶…å¸‚æ¡è²·ï½œç‰‡ç”ºæ•£æ­¥",
      cards: [
        {
          type: "æ™¯é»",
          title: "å…¼å…­åœ’",
          time: "08:00-17:00ï½œ320å††",
          place: "Kenrokuen Garden",
          detail: "å†¬å¤©å¾ˆå€¼å¾—çœ‹é›ªåŠï¼ˆYukitsuriï¼‰æ™¯è§€ï¼Œæ•´é«”æ°›åœå¾ˆæ—¥å¼ã€‚",
          tags: [
            { kind:"order", text:"å¿…æ‹ï¼šé›ªåŠï¼‹æ± æ™¯" }
          ],
          navQuery: "å…¼å…­åœ’"
        },
        {
          type: "æ™¯é»",
          title: "é‡‘æ¾¤åŸ",
          time: "08:00-17:00ï½œåœ’å€å…è²»ï¼ˆéƒ¨åˆ†å±•å€ä»˜è²»ï¼‰",
          place: "Kanazawa Castle Park",
          detail: "å’Œå…¼å…­åœ’åŒå€ï¼Œå¾ˆé©åˆå®‰æ’é€£èµ°ã€‚",
          navQuery: "é‡‘æ²¢åŸå…¬åœ’"
        },
        {
          type: "è³¼ç‰©",
          title: "Kajimart Kanazawa Mâ€™ZA Storeï¼ˆè¶…å¸‚æ¡è²·ï¼‰",
          time: "10:00-19:30",
          place: "Kajimart Kanazawa Mâ€™ZA Store",
          detail: "æ¡è²·å®Œå›é£¯åº—æ”¾ï¼Œå†ç¹¼çºŒæ™šä¸Šçš„æ•£æ­¥è¡Œç¨‹ã€‚",
          navQuery: "Kajimart Kanazawa M'ZA"
        },
        {
          type: "æ™¯é»",
          title: "ç¥ç¤¾åƒæ‹œï¼ˆä¸‰é¸ä¸€ï¼‰",
          time: "æ™šé–“",
          place: "å°¾å±±ç¥ç¤¾ / çŸ³æµ¦ç¥ç¤¾ / é‡‘æ¾¤ç¥ç¤¾",
          detail: "ä¾ä½ å€‘ç•¶ä¸‹é«”åŠ›èˆ‡å‹•ç·šé¸ä¸€é–“å°±å¥½ã€‚",
          navQuery: "å°¾å±±ç¥ç¤¾"
        },
        {
          type: "é¤å»³",
          title: "ç‰‡ç”ºãƒ»é—œæ±ç…®ï¼‹æ‰­è›‹ï¼ˆC-plaï¼‰",
          time: "æ™šé–“æ•£æ­¥",
          place: "ç‰‡ç”ºå•†åœˆ",
          detail: "åƒé»ç†±çš„æœ€èˆ’æœï¼šé—œæ±ç…® / å°åƒï¼›å†å» C-pla æ‰­è›‹æ”¶å°¾ã€‚",
          tags: [
            { kind:"eat", text:"å¿…åƒï¼šé—œæ±ç…®ï¼ˆç†±æ¹¯æ•‘å‘½ï¼‰" },
            { kind:"buy", text:"å¿…ç©ï¼šC-pla æ‰­è›‹" }
          ],
          navQuery: "é‡‘æ²¢ ç‰‡ç”º"
        }
      ]
    },

    {
      date: "2026-01-05ï¼ˆä¸€ï¼‰",
      city: "é‡‘æ¾¤ â†’ å°æ¾ â†’ æ¡ƒåœ’",
      weatherCity: "å°æ¾",
      focus: "å›ç¨‹æ—¥ï½œææ—©ç§»å‹•ï½œå¹³å®‰åˆ°å®¶",
      cards: [
        {
          type: "äº¤é€š",
          title: "é‡‘æ¾¤ â†’ å°æ¾æ©Ÿå ´ï¼ˆå·´å£«ï¼‰",
          time: "ç´„40åˆ†ï½œå»ºè­°ææ—©",
          place: "é‡‘æ¾¤ç«™è¥¿å£",
          detail: "ä½  PDF è¨»è¨˜æœ‰æ™‚åˆ»è¡¨é€£çµï¼›ç•¶å¤©ä»¥æœ€æ–°ç­æ¬¡ç‚ºæº–ã€‚",
          tags: [
            { kind:"code", text:"é‡è¦ï¼šå›ç¨‹åˆ¥å£“ç·šï¼ˆé ç•™å¡è»Š/æ’éšŠï¼‰" }
          ],
          navQuery: "é‡‘æ²¢é§… è¥¿å£"
        },
        {
          type: "äº¤é€š",
          title: "BR157 å°æ¾ â†’ æ¡ƒåœ’",
          time: "11:45 - 14:35",
          place: "å°æ¾ç©ºæ¸¯",
          detail: "æŠµé”ï¼šæ¡ƒåœ’äºŒèˆªã€‚",
          navQuery: "å°æ¾ç©ºæ¸¯"
        }
      ]
    },
  ];

  // ===== å°èˆª URLï¼ˆGoogle Maps Searchï¼Œå…åº§æ¨™ä¹Ÿèƒ½ç”¨ï¼‰=====
  function mapsSearchUrl(query){
    return "https://www.google.com/maps/search/?api=1&query=" + encodeURIComponent(query);
  }

  // ===== UI icons =====
  const ICONS = {
    "æ™¯é»": `<svg viewBox="0 0 24 24" fill="none"><path d="M12 21s7-6 7-12a7 7 0 1 0-14 0c0 6 7 12 7 12Z" stroke="currentColor" stroke-width="1.8"/><path d="M12 12.2a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" stroke="currentColor" stroke-width="1.8"/></svg>`,
    "é¤å»³": `<svg viewBox="0 0 24 24" fill="none"><path d="M7 3v9m0 0c0 2 2 2 2 0V3m-2 9c0 2-2 2-2 0V3m10 0v18m0-18c2 0 3 2 3 4v5h-3" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>`,
    "äº¤é€š": `<svg viewBox="0 0 24 24" fill="none"><path d="M4 16V7a3 3 0 0 1 3-3h8a3 3 0 0 1 3 3v9" stroke="currentColor" stroke-width="1.8"/><path d="M6.5 16h11M7 20a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Zm10 0a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z" stroke="currentColor" stroke-width="1.8"/></svg>`,
    "è³¼ç‰©": `<svg viewBox="0 0 24 24" fill="none"><path d="M6 8h15l-2 12H7L6 8Z" stroke="currentColor" stroke-width="1.8"/><path d="M9 8a3 3 0 0 1 6 0" stroke="currentColor" stroke-width="1.8"/></svg>`,
    "å°éŠ": `<svg viewBox="0 0 24 24" fill="none"><path d="M4 19V6a2 2 0 0 1 2-2h12v17l-6-3-6 3Z" stroke="currentColor" stroke-width="1.8"/></svg>`
  };

  function typeLabel(type){
    const map = {
      "æ™¯é»":"æ™¯é»",
      "é¤å»³":"é¤å»³",
      "äº¤é€š":"äº¤é€š",
      "è³¼ç‰©":"è³¼ç‰©",
      "å°éŠ":"å°éŠ"
    };
    return map[type] || type;
  }

  // ===== å¤©æ°£ï¼šOpen-Meteoï¼ˆå… keyï¼‰=====
  function wxIcon(code){
    // ç°¡å–®æ˜ å°„ï¼Œä¸è¿½æ±‚å®Œç¾
    // https://open-meteo.com/en/docs
    if(code === null || code === undefined) return "â˜ï¸";
    if([0].includes(code)) return "â˜€ï¸";
    if([1,2,3].includes(code)) return "â›…ï¸";
    if([45,48].includes(code)) return "ğŸŒ«ï¸";
    if([51,53,55,56,57].includes(code)) return "ğŸŒ¦ï¸";
    if([61,63,65,66,67].includes(code)) return "ğŸŒ§ï¸";
    if([71,73,75,77].includes(code)) return "â„ï¸";
    if([80,81,82].includes(code)) return "ğŸŒ§ï¸";
    if([85,86].includes(code)) return "ğŸŒ¨ï¸";
    if([95,96,99].includes(code)) return "â›ˆï¸";
    return "â˜ï¸";
  }

  async function fetchWeather(city){
    const geo = cityGeo[city];
    if(!geo) return null;
    const url =
      `https://api.open-meteo.com/v1/forecast?latitude=${geo.lat}&longitude=${geo.lon}` +
      `&current=temperature_2m,weather_code,wind_speed_10m` +
      `&timezone=Asia%2FTokyo`;
    try{
      const res = await fetch(url, {cache:"no-store"});
      if(!res.ok) throw new Error("weather fetch failed");
      const data = await res.json();
      const t = data?.current?.temperature_2m;
      const code = data?.current?.weather_code;
      const wind = data?.current?.wind_speed_10m;
      return { t, code, wind };
    }catch(e){
      return { error:true };
    }
  }

  // ===== æ¸²æŸ“æ¯æ—¥å¡ç‰‡ =====
  function cardTypePill(type){
    const emoji = {
      "æ™¯é»":"ğŸ“",
      "é¤å»³":"ğŸ´",
      "äº¤é€š":"ğŸšŒ",
      "è³¼ç‰©":"ğŸ›ï¸",
      "å°éŠ":"ğŸ§­"
    }[type] || "â€¢";
    return `${emoji} ${typeLabel(type)}`;
  }

  function renderTag(tag){
    const cls = tag.kind ? `tag ${tag.kind}` : "";
    return `<span class="chip ${cls}">${escapeHtml(tag.text)}</span>`;
  }

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function render(){
    const root = document.getElementById("days");
    root.innerHTML = itinerary.map((d, idx) => {
      return `
        <div class="day" data-day="${idx}">
          <div class="day-head">
            <div class="row">
              <div>
                <h3>${escapeHtml(d.date)}ï½œ${escapeHtml(d.city)}</h3>
                <p class="subtitle">${escapeHtml(d.focus)}</p>
              </div>
              <div class="weather">
                <div class="wx-badge" id="wx-${idx}">
                  <span class="wx">è®€å–å¤©æ°£â€¦</span>
                  <small>${escapeHtml(d.weatherCity)}</small>
                </div>
              </div>
            </div>
          </div>

          <div class="cards">
            ${d.cards.map(c => {
              const nav = c.navQuery ? mapsSearchUrl(c.navQuery) : null;
              const tags = (c.tags || []).map(renderTag).join("");
              const icon = ICONS[c.type] || "";
              return `
                <div class="card">
                  <div class="card-top">
                    <div>
                      <h4>${cardTypePill(c.type)}ã€€${escapeHtml(c.title)}</h4>
                      <p class="meta">${escapeHtml(c.time || "")}</p>
                      <p class="meta"><b>${escapeHtml(c.place || "")}</b></p>
                    </div>
                    <div class="right">
                      ${nav ? `
                        <a class="btn primary" target="_blank" rel="noopener" href="${nav}">
                          ${ICONS["æ™¯é»"]}
                          å°èˆª
                        </a>` : ""
                      }
                      ${c.url ? `
                        <a class="btn" target="_blank" rel="noopener" href="${c.url}">
                          ğŸ”— é€£çµ
                        </a>` : ""
                      }
                    </div>
                  </div>
                  ${c.detail ? `<p class="meta" style="white-space:pre-line">${escapeHtml(c.detail)}</p>` : ""}
                  ${tags ? `<div class="chips">${tags}</div>` : ""}
                </div>
              `;
            }).join("")}
          </div>
        </div>
      `;
    }).join("");
  }

  async function hydrateWeather(){
    for(let i=0;i<itinerary.length;i++){
      const city = itinerary[i].weatherCity;
      const box = document.getElementById(`wx-${i}`);
      const wx = await fetchWeather(city);
      if(!box) continue;
      if(!wx || wx.error){
        box.innerHTML = `<span class="wx">å¤©æ°£è®€å–å¤±æ•—</span><small>${city}</small>`;
        continue;
      }
      const icon = wxIcon(wx.code);
      const t = (wx.t ?? "â€”");
      const wind = (wx.wind ?? "â€”");
      box.innerHTML = `
        <span class="wx">${icon} ${t}Â°C</span>
        <small>${city}ï½œé¢¨ ${wind} km/h</small>
      `;
    }
  }

  // ===== Tabs =====
  const tabs = [
    { tab:"tab-itin", page:"page-itin" },
    { tab:"tab-info", page:"page-info" },
    { tab:"tab-budget", page:"page-budget" },
    { tab:"tab-notes", page:"page-notes" },
  ];

  function setTab(activeId){
    for(const t of tabs){
      const btn = document.getElementById(t.tab);
      const page = document.getElementById(t.page);
      const active = (t.tab === activeId);
      btn.setAttribute("aria-selected", active ? "true" : "false");
      page.hidden = !active;
    }
    window.scrollTo({top:0, behavior:"smooth"});
  }

  tabs.forEach(t=>{
    document.getElementById(t.tab).addEventListener("click", ()=>setTab(t.tab));
  });

  // ===== è¨˜å¸³ï¼ˆlocalStorageï¼‰=====
  const LS_KEY = "trip_expenses_kanazawa_2026";
  const LS_CODES = "trip_codes_kanazawa_2026";
  const LS_REM = "trip_rem_kanazawa_2026";

  function loadExpenses(){
    try{ return JSON.parse(localStorage.getItem(LS_KEY) || "[]"); }
    catch{ return []; }
  }
  function saveExpenses(list){
    localStorage.setItem(LS_KEY, JSON.stringify(list));
  }
  function money(n){
    const x = Number(n||0);
    return x.toLocaleString("en-US");
  }
  function toast(msg="å·²å„²å­˜"){
    const t = document.getElementById("toast");
    t.textContent = msg;
    t.classList.add("show");
    setTimeout(()=>t.classList.remove("show"), 1400);
  }

  function calcSettlement(expenses){
    // å›å‚³ï¼šæ¯å€‹äºº paid / share / net(æ‡‰æ”¶ç‚ºæ­£ï¼Œæ‡‰ä»˜ç‚ºè² )
    const people = ["æ²ˆ","ç‘„","YO"];
    const paid = Object.fromEntries(people.map(p=>[p,0]));
    const share = Object.fromEntries(people.map(p=>[p,0]));

    for(const e of expenses){
      paid[e.payer] += e.amount;
      share["æ²ˆ"] += e.split?.æ²ˆ ?? 0;
      share["ç‘„"] += e.split?.ç‘„ ?? 0;
      share["YO"] += e.split?.YO ?? 0;
    }
    const net = Object.fromEntries(people.map(p=>[p, paid[p]-share[p]]));
    return {paid, share, net};
  }

  function renderExpenses(){
    const list = loadExpenses();
    const wrap = document.getElementById("expenseList");
    const sum = list.reduce((a,b)=>a+Number(b.amount||0),0);
    document.getElementById("sumAll").textContent = money(sum);

    const st = calcSettlement(list);
    // æ‰¾æœ€å¤§æ‡‰æ”¶èˆ‡æœ€å¤§æ‡‰ä»˜åšä¸€å¥æç¤º
    const entries = Object.entries(st.net);
    const recv = entries.reduce((best, cur)=> cur[1]>best[1]?cur:best, ["", -1e18]);
    const pay  = entries.reduce((best, cur)=> cur[1]<best[1]?cur:best, ["",  1e18]);
    const hint = (sum===0) ? "â€”" : `${pay[0]} â†’ ${recv[0]}ï¼ˆæ¦‚ç®—ï¼‰`;
    document.getElementById("settleHint").textContent = hint;

    wrap.innerHTML = list.length ? list.map((e, idx)=>{
      const nav = e.title ? mapsSearchUrl(e.title) : null;
      return `
        <div class="card" data-idx="${idx}">
          <div class="card-top">
            <div>
              <h4>${escapeHtml(e.title || "ï¼ˆæœªå‘½åï¼‰")}</h4>
              <p class="meta">${escapeHtml(e.cat)}ï½œä»˜æ¬¾ï¼š${escapeHtml(e.payer)}ï½œé‡‘é¡ï¼š<b>${money(e.amount)}</b> å††</p>
              <p class="meta small muted">åˆ†æ”¤ï¼šæ²ˆ ${money(e.split.æ²ˆ)} / ç‘„ ${money(e.split.ç‘„)} / YO ${money(e.split.YO)}</p>
            </div>
            <div class="right">
              ${nav ? `<a class="btn" target="_blank" rel="noopener" href="${nav}">ğŸ” æŸ¥åœ°é»</a>`:""}
              <button class="btn" onclick="deleteExpense(${idx})">åˆªé™¤</button>
            </div>
          </div>
        </div>
      `;
    }).join("") : `<div class="note">ç›®å‰æ²’æœ‰æ˜ç´°ã€‚å…ˆåŠ ä¸€ç­†çœ‹çœ‹ï½</div>`;
  }

  window.deleteExpense = function(idx){
    const list = loadExpenses();
    list.splice(idx,1);
    saveExpenses(list);
    renderExpenses();
    toast("å·²åˆªé™¤");
  }

  function setupBudget(){
    const mode = document.getElementById("expSplitMode");
    const custom = document.getElementById("customSplit");
    mode.addEventListener("change", ()=>{
      custom.hidden = (mode.value !== "custom");
    });

    document.getElementById("addExpense").addEventListener("click", ()=>{
      const title = document.getElementById("expTitle").value.trim();
      const amount = Number(document.getElementById("expAmount").value);
      const cat = document.getElementById("expCat").value;
      const payer = document.getElementById("expPayer").value;
      const splitMode = mode.value;

      if(!amount || amount<=0){
        toast("è«‹è¼¸å…¥é‡‘é¡");
        return;
      }

      let split;
      if(splitMode === "equal"){
        const base = Math.floor(amount/3);
        const rem = amount - base*3;
        // æŠŠé¤˜æ•¸åˆ†é…çµ¦å‰é¢çš„äººï¼ˆè®“åˆè¨ˆæ­£ç¢ºï¼‰
        split = { æ²ˆ: base + (rem>0?1:0), ç‘„: base + (rem>1?1:0), YO: base };
      }else{
        const s = Number(document.getElementById("splitShen").value||0);
        const x = Number(document.getElementById("splitXuan").value||0);
        const y = Number(document.getElementById("splitYO").value||0);
        if(s+x+y !== amount){
          toast("è‡ªè¨‚åˆ†æ”¤åˆè¨ˆéœ€ç­‰æ–¼é‡‘é¡");
          return;
        }
        split = { æ²ˆ:s, ç‘„:x, YO:y };
      }

      const list = loadExpenses();
      list.unshift({
        title: title || `ï¼ˆ${cat}ï¼‰`,
        amount,
        cat,
        payer,
        split,
        ts: Date.now()
      });
      saveExpenses(list);

      document.getElementById("expTitle").value = "";
      document.getElementById("expAmount").value = "";
      document.getElementById("splitShen").value = "";
      document.getElementById("splitXuan").value = "";
      document.getElementById("splitYO").value = "";

      renderExpenses();
      toast("å·²åŠ å…¥");
    });

    document.getElementById("clearAll").addEventListener("click", ()=>{
      if(confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è¨˜å¸³è³‡æ–™å—ï¼Ÿï¼ˆåªæ¸…æœ¬æ©Ÿï¼‰")){
        localStorage.removeItem(LS_KEY);
        renderExpenses();
        toast("å·²æ¸…ç©º");
      }
    });

    renderExpenses();
  }

  // ===== å°ç­†è¨˜ï¼šé‡è¦ä»£è™Ÿ / æé†’ =====
  function setupNotes(){
    const codes = document.getElementById("codes");
    const rem = document.getElementById("reminders");
    codes.value = localStorage.getItem(LS_CODES) || "";
    rem.value = localStorage.getItem(LS_REM) || "";

    document.getElementById("saveCodes").addEventListener("click", ()=>{
      localStorage.setItem(LS_CODES, codes.value);
      toast("ä»£è™Ÿå·²å„²å­˜");
    });
    document.getElementById("saveRem").addEventListener("click", ()=>{
      localStorage.setItem(LS_REM, rem.value);
      toast("æé†’å·²å„²å­˜");
    });
  }

  // ===== init =====
  render();
  hydrateWeather();
  setupBudget();
  setupNotes();
</script>
</body>
</html>
